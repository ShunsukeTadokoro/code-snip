<link rel="import" href="../account/account-info-name.html">
<link rel="import" href="../account/account-option.html">
<link rel="import" href="../post/code-tags.html">
<link rel="import" href="../post/code-tags-mini.html">
<link rel="import" href="../account/recommend-user.html">
<dom-module id="snip-account">
  <style>
    :host {
      display: block;
      padding: 20px;
    }

    :host .account-follow {
      width: 100%;
      margin-top: 20px;
      border-top: 3px #eaeaea double;
      padding-top: 15px;
      display: table;
      table-layout: fixed;
    }

    :host .account-follow dl {
      display: table-cell;
      line-height: 1.2;
    }

    :host .account-follow dt {
      font-size: 12px;
      color: #b4b4b4;
      font-weight: bold;
    }

    :host .account-follow dd {
      font-size: 18px;
      margin-top: 5px;
      font-weight: bold;
    }

    :host .account-tag {
      margin-top: 15px;
    }

    :host .account-tag h3,
    :host .account-recommend h3 {
      font-size: 12px;
      color: #b4b4b4;
      font-weight: bold;
      margin: 0;
      line-height: 1.2;
    }

    :host code-tags {
      line-height: 20px;
      margin-top: 4px;
    }

    :host .account-recommend {
      margin-top: 15px;
      border-top: 3px #eaeaea double;
      padding-top: 15px;
    }

    :host .account-option {
      width: 100%;
      overflow: hidden;
      position: absolute;
      bottom: 0;
      left: 0;
      padding: 15px;
      font-size: 14px;
    }

    :host .account-option paper-button {
      line-height: 1.2;
      text-transform: none;
      background: #eee;
    }

  </style>
  <template>
    <account-info-name>
      <img src="/assets/images/dammy.jpeg" width="50" height="50">
      <h2>{{status.accountName}}</h2>
    </account-info-name>
    <div class="account-follow">
      <dl>
        <dt>Follow</dt>
        <dd><a href="#" tabindex="-1">{{status.follow}}</a></dd>
      </dl>
      <dl>
        <dt>Follower</dt>
        <dd><a href="#" tabindex="-1">{{status.follower}}</a></dd>
      </dl>
    </div>
    <div class="account-tag">
      <h3>Interested in</h3>
      <code-tags tags="{{status.interests}}"></code-tags>
    </div>
    <div class="account-recommend">
      <h3>Recommend Users</h3>
      <recommend-user></recommend-user>
    </div>
    <div class="account-option">
      <paper-button on-click="logout" tabindex="-1">Log out</paper-button>
    </div>

    <iron-ajax
      with-credentials
      id="logoutAjax"
      url="http://localhost:9000/logout"
      method="GET"
      on-response="logoutResponse"
      on-error="logoutError"></iron-ajax>
    <iron-ajax
      with-credentials
      id="statusAjax"
      url="http://localhost:9000/status"
      method="GET"
      on-response="statusResponse"
      on-error="statusError"></iron-ajax>
  </template>

  <script>
    (function() {
      Polymer({
        is: 'snip-account',
        properties: {
          status: Object
        },
        ready: function() {
          var _this = this;
          document.addEventListener('pleaseCountFollow', function(){
            _this._sendAjax();
          });
          this._sendAjax();
        },
        _sendAjax: function(){
          var _this = this;
          setTimeout(function(){
            _this.$.statusAjax.generateRequest();
          },500);
        },
        logout: function() {
          this.$.logoutAjax.generateRequest();
        },
        logoutResponse: function(request) {
          location.href = '/#!login';
        },
        logoutError: function (e) {
          console.log(e);
        },
        statusResponse: function(request) {
          this.status = this.$.statusAjax.lastResponse;
        },
        statusError: function(e) {
        }

      });
    })();
  </script>

</dom-module>

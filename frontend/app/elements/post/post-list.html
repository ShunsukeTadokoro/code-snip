<link rel="import" href="post-card.html">

<dom-module id="post-list">
  <template>
    <iron-ajax
      with-credentials
      id="postsAjax"
      url="http://localhost:9000/timeline"
      method="GET"
      handle-as="json"
      on-response="handleResponse"
      on-error="handleError"></iron-ajax>
    <template is="dom-repeat" items="{{posts}}">
      <post-card>
        <h2>{{item.user.accountName}}</h2>
        <img src="/assets/images/dammy.jpeg" width="50" height="50">
        <code>{{item.post.code}}</code>
        <p>{{item.post.description}}</p>
        <i>{{item.post.tag}}</i>
        <time>{{item.post.time}}</time>
      </post-card>
    </template>
  </template>

  <script>
    Polymer({
      is: 'post-list',
      properties: {
        target: String,
      },
      ready: function() {
        this.sendAjax();
        this.readyFlg = true;
      },
      sendAjax: function() {
        this.$.postsAjax.url = "http://localhost:9000/" + this.target;
        this.$.postsAjax.generateRequest();
      },
      handleResponse: function(request) {
        var res = this.$.postsAjax.lastResponse;
        this.posts = res;
      },
      handleError: function() {
        console.error("something wrong");
      }
    });
  </script>
</dom-module>
